Platypus Conquistador Tutorial
==============================

To start you will need:
- Your experimental sequences
- A full version of [Integrated Microbial Genomes](http://img.jgi.doe.gov/)

However, for convenience we provide (ftp://ftp.microbio.me/pub/platypus/tutorial_example.tgz) a minimized version of the raw files used for [Ottesen et al., 2013](http://www.ncbi.nlm.nih.gov/pubmed/23705801). The minimized version were generated by randomly subsampling the original files so they can run on any computer. The tar file contains an example of the bacterial contigs files (taxonomy and sequences) and the clean sequence files generated by MG-RAST.

Untar the files and move to the new created folder:
`tar zxvf tutorial_example.tgz; cd tutorial`

Now we need to split our database in the interest and rest databases. For this example, we will look for any occurrences of the word salmonella:
`platypus split_db --tax_fp bacteria.contigs.txt --seqs_fp bacteria.contigs.fna --query 'salmonella' --output_fp databases`

The next step is to create a basic [QIIME](http://qiime.org) mapping file for each input file to QC them again. Note that this is not a necessary step but will help us remove some problematic and noisy sequences, which are left behind by MG-RAST.
``` bash
mkdir maps
for i in `ls input_samples/`; do printf "#SampleID\tBarcodeSequence\tLinkerPrimerSequence\tDescription\n%s\t\t\t%s\n" $i $i > maps/${i/.fna}.txt; done
for i in `ls input_samples/`; do split_libraries.py -f input_samples/${i} -l 75 -b 0 -m maps/${i/.fna}.txt -o splitLib/${i/.fna} -c -p; done
cat splitLib/*/seqs.fna > splitLib/seqs.fna
```

After this we will have a single seqs.fna file with all the QC-ed files so we are ready to BLAST with relaxed parameters agains the interest and rest database. In this example, we are going to use 2 jobs for the processing.
``` bash
mkdir blastOut
parallel_blast.py -O 2 -n 10 -w 11 -e .1 -r databases/rest.fna -i splitLib/seqs.fna -o blastOut/rest
parallel_blast.py -O 2 -n 10 -w 11 -e .1 -r databases/interest.fna -i splitLib/seqs.fna -o blastOut/interest
```

Now we should have two files with the results of BLASTing against the interest and the rest databases. Consequently, we can use these resulting files to compare the results and confirm the presence/absence of Salmonella in our files. In the example command, we are using different levels of similarity: 80, 85, 90, 95, 100, and different lengths for the alignment: 80, 100.
`platypus compare --other_fp blastOut/rest/seqs_blast_out.txt --interest_fp blastOut/interest/seqs_blast_out.txt --interest_pcts 80 --interest_pcts 85 --interest_pcts 90 --interest_pcts 95 --interest_pcts 100 --interest_alg_lengths 80 --interest_alg_lengths 100 -o compare`

This last step will create several files with the summary of each combination of options (% identity, and alignment length), each summary will have the sequences that matched at any given level and two compiled results: compile_output_no_nohits.txt, results without those sequences that weren't found in the first DB, and compile_output.txt, all results.
